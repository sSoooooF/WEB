### SMTP
Протокол SMTP, работающий по принципу клиент-сервер, предназначен для отправки сообщений с компьютера к адресату.

При отправке сообщения с почты mail на почту Yandex возникает проблема: в БД mail необходимо сохранить отправленный, а в БД Yandex необходимо сохранить полученный. **Взаимодействие между двумя серверами** должно **осуществляться автоматически** без участия пользователя. 
Но в этом случае первый сервер не имеет понятия о том, кому мы отправляем письмо (существует ли он вообще). И наоборот. 
**Задача SMTP** (Simple Mail Transfer Protocol**)** обеспечить пересылку писем между двумя БД разных серверов. Данный протокол работает по 25 порту.

![[Pasted image 20241225012700.png]]
MUA – Mail User Agent 
MTA – Mail Transfer Agent
MSA – Mail Service Agent (обеспечивает аутентификацию пользователя)
Пересылка осуществляется между MTA первого сервера и MTA второго сервера.


### MTA, отличие от MUA
Изначальным хостом (SMTP-клиентом) может быть как почтовый клиент конечного пользователя (MUA), так и агент пересылки сообщений (MTA) на сервере. Например, пересылки почтовых сообщений с сервера yandex.ru на сервера mail.ru применяется протокол SMTP. При этом клиент (почтовый сервер yandex.ru) является MTA. MUA обычно представлен в виде почтовой программы на персональном компьютере клиента.
MUA знает SMTP-сервер для исходящей почты из своих настроек. SMTP-сервер, действующий как клиент, то есть пересылающий сообщения, определяет, к какому серверу подключиться, просмотром ресурса записей MX (Mail eXchange) DNS для домена каждого получателя (часть адреса, находящаяся справа от символа @). В случае, если запись MX не найдена, совместимые MTA возвращаются к простой А-записи DNS.
SMTP-сервер, действующий как клиент, устанавливает TCP-соединение с сервером по порту 25. MUA должен использовать порт 587 для подключения к агенту предоставления сообщений (MSA). Основное различие между MTA и MSA заключается в том, что SMTP-аутентификация обязательна только для последнего. В случае если MTA клиент пересылает почту MTA клиенту, то авторизация не требуется.

### MAIL FROM. RCPT TO. DATA. TURN.
MAIL FROM — устанавливает обратный адрес. Это адрес для возвращённых писем.

RCPT TO — устанавливает получателя данного сообщения. Эта команда может быть дана несколько раз, по одной на каждого получателя. 

DATA — для отправки текста сообщения. Состоит из заголовка сообщения и тела сообщения, разделённых пустой строкой. DATA, по сути, является группой команд, а сервер отвечает дважды: первый раз на саму команду DATA, для уведомления о готовности принять текст; и второй раз после конца последовательности данных, чтобы принять или отклонить всё письмо.

TURN - команда SMTP-приемнику либо сказать ОК и поменяться ролями, то есть стать SMTP- передатчиком, либо послать сообщение-отказ и остаться в роли SMTP-приемника.