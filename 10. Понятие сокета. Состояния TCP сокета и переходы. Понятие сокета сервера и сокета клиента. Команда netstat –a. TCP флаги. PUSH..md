
### Понятие сокета
Сокет – абстрактный объект, предоставляющий конечную точку соединения. Существуют INET и UNIX сокеты, оба предоставляющие конечную точку, но работающих в различных средах. UNIX сокеты предназначены для передачи информации в рамках операционной системы и являются средствами межпроцессного взаимодействия (IPC), в то время, как INET сокеты обеспечивают передачу данных по сети.
Сокет определяется парой Адрес (сетевой уровень) и Порт (транспортный уровень). Такая пара позволяет полностью определить конечный узел, в который будут отправляться или приниматься данные.


### Состояния TCP сокета и переходы.
![[Pasted image 20241222212250.png]]
- LISTEN — сервер готов принимать входящие соединения. Один из наиболее частых состояний сокета. Данное состояние устанавливается сокет-сервером после выполнения функции listen(). Для данных соединения не указывается внешний адрес, так как соединение еще не установлено.
- ESTABLISHED — клиент установил соединение с сервером, получив от сервера сообщение SYN (этап 2). Такое состояние устанавливается, если происходит (или ожидается) передача данных между двумя сокетами. Для данного состояния обязательно указывать внешний сокет.
- TIME_WAIT — клиент отправил сообщение FIN серверу и ожидает ответа на это сообщение. (этап 5)
- CLOSE_WAIT — указывает на пассивную фазу закрытия соединения, которая начинается после получения сервером сообщения FIN от клиента (этап 4).
- CLOSED — соединение прервано и закрыто сервером.
- FIN_WAIT_1 — клиент инициировал закрытие соединения (отправил сообщение FIN). (этап 4)
- FIN_WAIT_2 — клиент получил сообщения ACK и FIN от сервера. (этап 5)
- LAST_ACK — сервер отправил сообщение FIN клиенту.
- SYN_RECEIVED — сервер получил сообщение SYN от клиента и отправил ему ответ.
- SYN_SEND — указанное соединение активно и открыто.

### Понятие сокета сервера и сокета клиента.
При организации соединения сокеты делятся на клиентские и серверные. При этом обмениваться информацией и дальнейшая работа сокета может осуществляться и со сменой ролей и однорангово. Разделение на серверные и клиентские сокеты позволяет определить правила установления соединения, сервер ждет, когда к нему подключится клиент.
Сервер-сокет необходимо «привязать» к сокету (к порту и ip адресу), настроить на прослушивание этого порта (процесс уходит в состояние блокировки) и указать действия при получении пакета на выбранный порт. Для клиента-сокета необходимо «привязать» к сокету (к порту и ip адресу) и подключиться к сокету-серверу по (ip адресу сервера и порту-сервера). В результате сервер настраивает (и, соответственно, знает) только сой ip адрес и порт, а клиент как свой ip адрес и порт, так и ip адрес и порт сервера. При этом могут использоваться как IPv4 так и IPv6 адреса.

### Команда netstat –a.
Данная команда отображает все TCP и UDP соединения. Во втором столбце указывается локальный адрес, который часто совпадает либо с ip адресами 0.0.0.0, 127.0.0.1 (localhost), [::]  или внутреннем ip адресам (IPv4 или IPv6) компьютера. Кроме известного, по другим командам (например, ipconfig) ip адреса указывается порт. Данное сочетание определяет все сокеты (как сокеты-серверы, так и сокеты-клиенты), созданные в операционной системе. Третий столбец, внешний адрес, указывает сокет, к которому подключается сокет, указанный в столбце «локальный адрес». Для данного соединения указывается состояние этого соединения. Для протокола UDP соединение не устанавливается, поэтому указывается только открытый сокет на стороне локального адреса (операционной системы).

### TCP флаги
- Reserved
- Accurate ECN
- Congestion Window Reduced
- ECN-Echo
- Urgent - Указывает, что данные в сегменте имеют высокий приоритет и должны быть обработаны немедленно.
- Ack - Подтверждает получение данных. Если этот флаг установлен, поле `Acknowledgment Number` в заголовке становится значимым и указывает номер следующего ожидаемого байта.
- Push - Требует немедленной передачи данных без ожидания заполнения буфера. Это полезно для небольших пакетов, например, в интерактивных приложениях.
- Reset - Сбрасывает соединение. Используется для завершения неактивного или некорректного соединения. Также применяется, если порт или адрес недоступен.
- Syn - Используется для установления соединения. Указывает начальный номер последовательности (Sequence Number) и синхронизирует последовательности между клиентом и сервером.
- Fin - Указывает желание завершить соединение. После отправки FIN соединение остается активным до подтверждения завершения от другой стороны.