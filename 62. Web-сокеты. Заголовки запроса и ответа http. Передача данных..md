### Web-сокеты
[[61. Web-сокеты. Подключение, принцип работы. Преимущества и недостатки.]]

### Заголовки запроса и ответа http
Когда new WebSocket(url) создан, он тут же сам начинает устанавливать соединение. Вот пример заголовков для запроса, который делает new WebSocket("wss:// mai.ru /chat").
```
GET /chat
Host: mai.ru
Origin: https:// mai.ru
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==
Sec-WebSocket-Version: 13
```

Origin – источник текущей страницы (например https:// mai.ru).
Connection: Upgrade – сигнализирует, что клиент хотел бы изменить протокол.
Upgrade: websocket – запрошен протокол «websocket».
Sec-WebSocket-Key – случайный ключ, созданный браузером для обеспечения безопасности.
Sec-WebSocket-Version – версия протокола WebSocket.
Если сервер согласен переключиться на WebSocket, то он должен отправить в ответ код 101:
```
101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=
```

Здесь Sec-WebSocket-Accept – это Sec-WebSocket-Key, перекодированный с помощью специального алгоритма. Браузер использует его, чтобы убедиться, что ответ соответствует запросу.

### Передача данных.

Поток данных в WebSocket состоит из «фреймов», фрагментов данных, которые могут быть отправлены любой стороной, и которые могут быть следующих видов:
•    «текстовые фреймы» – содержат текстовые данные, которые стороны отправляют друг другу.
•    «бинарные фреймы» – содержат бинарные данные, которые стороны отправляют друг другу.
•    «пинг-понг фреймы» используется для проверки соединения; отправляется с сервера, браузер реагирует на них автоматически.
•    также есть «фрейм закрытия соединения» и некоторые другие служебные фреймы.

Как только одна сторона хочет передать другой какую-то информацию, она отправляет дата-фрейм следующего вида: 0x00, <строка в кодировке UTF-8>, 0xFF. Данную передачу могут осуществлять как клиент, так и сервер.

С помощью WebSockets так же можно передавать и бинарные данные. Для них используется другой дата-фрейм следующего вида: 0x80, <длина - один или несколько байт>, <тело сообщения>.