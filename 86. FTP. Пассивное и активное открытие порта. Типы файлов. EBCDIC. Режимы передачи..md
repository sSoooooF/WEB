### FTP
[[85. FTP. Порты и назначение. Основные команды. USER. PASS. LIST. CWD. REIN.]]

### Пассивное и активное открытие порта.
Сервер осуществляет пассивное открытие на заранее известный порт FTP (21) и ожидает запроса на соединение от клиента. Клиент осуществляет активное открытие на TCP порт 21, чтобы установить управляющее соединение.

Соединение для передачи данных использует заданный порт 20. Однако создание соединения для передачи данных отличается от предыдущего. FTP создает соединение для передачи данных следующим образом:
1. Клиент (не сервер) вызывает пассивное открытие кратковременного порта. Это может быть сделано клиентом, потому что клиент вызывает команды для передачи файлов.
2. Клиент посылает номер этого порта серверу, используя команду PORT (ниже эта команда будет рассмотрена).
3. Сервер получает номер порта, вызывает активное открытие заданного порта 20 и получает номер временного порта.

Соединение для обмена данными организуется по мере необходимости, и закрывается каждый раз после передачи или приема данных. Так происходит потому, что режим передачи данных между клиентом и сервером – потоковый, а в таком режиме окончание передачи данных определяется закрытием соединения.
### Типы файлов
FTP может передавать через соединение для передачи данных следующие типы файлов:
- **ASCII-файл**. Это формат, используемый по умолчанию для трансляции текстовых файлов. Каждый символ закодирован с использованием NVT ASCII-символов. Передатчик преобразует файл из собственного представления в NVT ASCII, и приемник преобразует символы NVTASCII в собственное представление.
- **EBCDIC-файл**. Если оба конца соединения используют кодирование EBCDIC, файл может быть передан с использованием EBCDIC-кодирования.
- **Image-файл**. Этот файл по умолчанию — формат для передачи двоичных файлов. Файл посылается как непрерывный поток бит без всякой интерпретации и кодирования. Он в большинстве случаев используется для передачи двоичных файлов, таких как компилированная программа.

### EBCDIC
Расширенный двоично-десятичный код обмена — восьмибитная кодировка символов, используемая в основном в операционных системах мэйнфреймов IBM и компьютеров среднего класса IBM

### Режимы передачи
FTP может передавать файл по соединению для передачи данных, используя один из трех следующих режимов передачи:
- **Поточный режим**. Это режим по умолчанию. Данные доставляются от FTP к TCP как непрерывный поток данных. TCP отвечает за разбиение данных на сегменты соответствующего размера. Если данные — просто поток байтов (файловая структура), то не нужно никакого признака окончания файла. Окончание файла в этом случае — это разъединение соединения данных отправителем. Если данные разделены на записи (структура по записи), каждая запись будет иметь однобайтный символ окончания записи (EOR — end of record).
- **Блочный режим**. Данные могут быть доставлены от FTP и TCP в блоках. В этом случае блоку предшествует трехбайтный заголовок. Первый байт называется дескриптор блока, следующие два байта определяют размер блока в байтах.
- **Сжатый режим**. Если файл большой, данные могут быть сжаты. Метод сжатия использует нормальное кодирование длины. В этом методе последовательное повторное появление блока данных заменяется одним вхождением и числом повторений. В тексте файла это обычно пробел (пустоты). В двоичном файле нулевые символы обычно сжимаются.